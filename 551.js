"use strict";(self.webpackChunkwebpages=self.webpackChunkwebpages||[]).push([[551],{4551:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var a=i(865),n=i.n(a),l=i(578),r=i(2641);let s={newAnnouncementTitle:"",newAnnouncementContent:"",newAnnouncementPublishing:!1,userlist:[],payments:[],selected_whitelist_item:null,selected_serverlist:{username:"",content:[]},addUser_Username:"",addUser_Password:"",addUser_InProgress:!1,db_cache_clean_wip:!1,az_TargetUsername:"",az_Value:"",az_InProgress:!1,whitelist_page:1,payments_page:1,whitelist_maxpage:1,payments_maxpage:1,whitelist_query:"",whitelist_query_additional:[!1,!1,!1,!1],payments_query:{username:"",hname:"",desc:""},pil_value:[],oninit:async()=>{let e=`${s.whitelist_query_additional[0]?"1":"0"}${s.whitelist_query_additional[1]?"1":"0"}${s.whitelist_query_additional[2]?"1":"0"}${s.whitelist_query_additional[3]?"1":"0"}${s.whitelist_query}`,t=await r.Z.GetWhitelistAndPayments(s.whitelist_page,s.payments_page,e,s.payments_query.username,s.payments_query.hname,s.payments_query.desc);s.userlist=t.wlist,s.payments=t.payments,s.whitelist_maxpage=t.pn_wlist,s.payments_maxpage=t.pn_plist,0==s.whitelist_maxpage&&(s.whitelist_maxpage=1),0==s.payments_maxpage&&(s.payments_maxpage=1),n().redraw()},view:e=>{let t=[];for(let e in s.pil_value)t.push(n()("tr",n()("th",{scope:"row"},e),n()("td",JSON.stringify(s.pil_value[e]))));let i=[];for(let e in s.userlist){let t=s.userlist[e],a=parseInt(e),o=[];t.banned&&o.push(n()("b",{style:{color:"red"}},"[B]")),t.admin&&o.push(n()("b",{style:{color:"red"}},"[ADMIN]")),t.allowed_to_use_phoenix&&o.push(n()("b",{style:{color:"blue"}},"[P]")),i.push(n()("tr",n()("th",{scope:"row"},[o,t.username]),n()("td",t.promocodeCount||"0"),t.editing?n()("td",n()("input.col-sm-4.form-control",{style:{width:"initial"},value:t.editing_psw,oninput:e=>{s.userlist[a].editing_psw=e.target.value},onkeypress:async e=>{"Enter"==e.key&&(e.preventDefault(),s.userlist[a].editing=!1,s.userlist[a].password=s.userlist[a].editing_psw,await r.Z.UpdateUserPassword(s.userlist[a].username,s.userlist[a].password),s.oninit())}})):n()("td",n()("a",{style:{cursor:"pointer"},onclick:e=>{e.preventDefault(),s.userlist[a].editing_psw="",s.userlist[a].editing=!0}},t.password.substr(0,8))),n()("td",[n()("button.btn.btn-primary",{onclick:async()=>{s.selected_whitelist_item=(await r.Z.GetUserWhitelistValue(s.userlist[a].username)).value,n().redraw()}},"DB")," ",n()("button.btn.btn-secondary",{onclick:()=>{s.selected_serverlist.username=s.userlist[a].username,s.selected_serverlist.content=s.userlist[a].rentalservers,n().redraw()}},"Serv.")," ",n()("button.btn.btn-danger",{onclick:async()=>{if(!await l.ZP.question("Remove user",`Remove user ${t.username}? This will remove the entry permanently from the database!`,!0))return;let e=await r.Z.RemoveUser(t.username);if(!e.success)return await l.ZP.showAlert("Failed",e.message);s.oninit()}},"Remove")])))}let a=[];a[0]=n()("li.page-item"+(1==s.whitelist_page?".disabled":""),n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.whitelist_page--,s.oninit()}},"^")),a.push(n()("li.page-item"+(1==s.whitelist_page?".disabled":""),n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.whitelist_page=1,s.oninit()}},"1"))),1==s.whitelist_page||s.whitelist_page==s.whitelist_maxpage?1==s.whitelist_maxpage?a.push(n()("li.page-item.disabled",n()("a.page-link","..."))):a.push(n()("li.page-item",n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.whitelist_page=2,s.oninit()}},"2"))):a.push(n()("li.page-item.disabled",n()("a.page-link",s.whitelist_page))),a.push(n()("li.page-item"+(1==s.whitelist_maxpage?".disabled":""),n()("a.page-link",{href:"#",onclick:async e=>{e.preventDefault();let t=await l.ZP.getInput("Jump","Jump to:","Page",!1,!1);if(!1===t)return;let i=parseInt(t);isNaN(i)||i>s.whitelist_maxpage||i<1?await l.ZP.showAlert("Jump","Invalid page number"):(s.whitelist_page=i,s.oninit())}},"..."))),a.push(n()("li.page-item"+(s.whitelist_page==s.whitelist_maxpage?".disabled":""),n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.whitelist_page=s.whitelist_maxpage,s.oninit()}},s.whitelist_maxpage))),a.push(n()("li.page-item"+(s.whitelist_page==s.whitelist_maxpage?".disabled":""),n()("a.page-link",{href:"#",style:{transform:"rotate(180deg)","border-top-left-radius":".25rem","border-top-right-radius":".25rem","border-bottom-left-radius":"initial","border-bottom-right-radius":"initial"},onclick:e=>{e.preventDefault(),s.whitelist_page++,s.oninit()}},"^")));let o=[];for(let e of s.payments){let t=e.helper;e.helper&&e.helper.length>20&&(t=e.helper.substr(0,20)+"..."),o.push(n()("tr",{style:e.refunded?"text-decoration-line:line-through;color:gray;":"",ondblclick:()=>{l.ZP.showAlert("Full Content",JSON.stringify(e,null,"\t"))}},n()("td",new Date(e.date).toLocaleString()),n()("td",e.username),n()("td",t||"(null)"),n()("td",e.price),n()("td",e.helper_price),n()("td",n().trust(e.description.replace(/\n/g,"<br/>")))))}let u=[];u.push(n()("li.page-item"+(1==s.payments_page?".disabled":""),n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.payments_page--,s.oninit()}},"^"))),u.push(n()("li.page-item"+(1==s.payments_page?".disabled":""),n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.payments_page=1,s.oninit()}},"1"))),1==s.payments_page||s.payments_page==s.payments_maxpage?1==s.payments_maxpage?u.push(n()("li.page-item.disabled",n()("a.page-link","..."))):u.push(n()("li.page-item",n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.payments_page=2,s.oninit()}},"2"))):u.push(n()("li.page-item.disabled",n()("a.page-link",s.payments_page))),u.push(n()("li.page-item"+(1==s.payments_maxpage?".disabled":""),n()("a.page-link",{href:"#",onclick:async e=>{e.preventDefault();let t=await l.ZP.getInput("Jump","Jump to:","Page",!1,!1);if(!1===t)return;let i=parseInt(t);isNaN(i)||i>s.payments_maxpage||i<1?await l.ZP.showAlert("Jump","Invalid page number"):(s.payments_page=i,s.oninit())}},"..."))),u.push(n()("li.page-item"+(s.payments_page==s.payments_maxpage?".disabled":""),n()("a.page-link",{href:"#",onclick:e=>{e.preventDefault(),s.payments_page=s.payments_maxpage,s.oninit()}},s.payments_maxpage))),u.push(n()("li.page-item"+(s.payments_page==s.payments_maxpage?".disabled":""),n()("a.page-link",{href:"#",style:{transform:"rotate(180deg)"},onclick:e=>{e.preventDefault(),s.payments_page++,s.oninit()}},"^")));let p=null;if(s.selected_whitelist_item){let e=[],t="???";for(let i of s.selected_whitelist_item){"username"==i.name&&(t=i.value);let a=i.has_value&&i.editable?i.value.toString():n()("label",{style:"color:gray;"},"(empty)");i.editable||(a=n()("label",{style:"color:gray;"},"(complex)"));let l=[];i.has_value&&l.push(n()("button.btn.btn-danger",{onclick:async e=>{await s.oninit(),s.selected_whitelist_item=(await r.Z.SetUserWhitelistValue(t,i.name,null)).value,n().redraw()}},"Unset")),e.push(n()("tr",n()("td",i.name),i.editing?n()("td",n()("input.col-sm-4.form-control",{style:{width:"initial"},value:i.editing_value,oninput:e=>{i.editing_value=e.target.value},onkeypress:async e=>{"Enter"==e.key&&(e.preventDefault(),s.selected_whitelist_item=(await r.Z.SetUserWhitelistValue(t,i.name,"int"==i.type?parseInt(i.editing_value):i.editing_value)).value,n().redraw())}})):n()("td",{style:i.editable?"cursor:pointer;":"",onclick:async e=>{if(e.preventDefault(),"bool"==i.type){let e=!0;return i.has_value&&i.value&&(e=!1),s.selected_whitelist_item=(await r.Z.SetUserWhitelistValue(t,i.name,e)).value,void n().redraw()}i.editing_value=i.has_value?i.value.toString():"",i.editing=!0}},a),n()("td",l)))}p=n()(l.ZP.section,{title:"Database document for "+t},n()("div.row.pre-scrollable",n()("table.table",n()("thead",n()("tr",n()("th",{scope:"col"},"Item"),n()("th",{scope:"col"},"Value"),n()("th",{scope:"col"},"Actions"))),n()("tbody",e))),n()("div",n()("button.btn.btn-primary",{onclick:async e=>{s.selected_whitelist_item=(await r.Z.GetUserWhitelistValue(t)).value,n().redraw()}},"Refresh")," ",n()("button.btn.btn-secondary",{onclick:()=>{s.selected_whitelist_item=null}},"Close")))}let d=null;if(s.selected_serverlist.username){let e=[];s.selected_serverlist.content||(s.selected_serverlist.content=[]);for(let t of s.selected_serverlist.content){let i=!1,a=0;if(t.locked&&(a="[One-Time]"),null!=t.lastdate||t.locked)if(t.locked)i=!1;else{let e=(new Date).getTime()/1e3-t.lastdate;e>2592e3?i=!0:a=Math.round((2592e3-e)/86400*100)/100}else i=!0;let l=[];i||l.push(n()("button.btn.btn-secondary",{onclick:async e=>{await r.Z.UnlockSlot(s.selected_serverlist.username,t.slotid),await s.oninit(),s.selected_serverlist.content=(await r.Z.GetRentalServerList(s.selected_serverlist.username)).rentalservers,n().redraw()}},"Unlock")),t.locked||(0!=l.length&&l.push(" "),l.push(n()("button.btn.btn-secondary",{onclick:async e=>{await r.Z.LockSlot(s.selected_serverlist.username,t.slotid),await s.oninit(),s.selected_serverlist.content=(await r.Z.GetRentalServerList(s.selected_serverlist.username)).rentalservers,n().redraw()}},"Lock"))),0!=l.length&&l.push(" "),l.push(n()("button.btn.btn-danger",{onclick:async e=>{await r.Z.RemoveSlot(s.selected_serverlist.username,t.slotid),await s.oninit(),s.selected_serverlist.content=(await r.Z.GetRentalServerList(s.selected_serverlist.username)).rentalservers,n().redraw()}},"Remove")),e.push(n()("tr",n()("td",t.slotid),n()("td",t.sid),n()("td",`${a}|${i}`),n()("td",l)))}d=n()(l.ZP.section,{title:"Server list for "+s.selected_serverlist.username},n()("div.row.pre-scrollable",n()("table.table",n()("thead",n()("tr",n()("th",{scope:"col"},"SlotID"),n()("th",{scope:"col"},"ServerID"),n()("th",{scope:"col"},"ATO|CanChange"),n()("th",{scope:"col"},"Actions"))),n()("tbody",e))),n()("div",n()("button.btn.btn-primary",{onclick:async e=>{await r.Z.AddSlot(s.selected_serverlist.username),await s.oninit(),s.selected_serverlist.content=(await r.Z.GetRentalServerList(s.selected_serverlist.username)).rentalservers,n().redraw()}},"Add")," ",n()("button.btn.btn-primary",{onclick:async e=>{await s.oninit(),s.selected_serverlist.content=(await r.Z.GetRentalServerList(s.selected_serverlist.username)).rentalservers,n().redraw()}},"Refresh")," ",n()("button.btn.btn-secondary",{onclick:()=>{s.selected_serverlist.content=[],s.selected_serverlist.username=""}},"Close")))}return n()(l.ZP.frame,{pageName:"用户中心管理",pageIcon:'<svg class="sectionTitle-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 512 512"><path d="M224 96.1v48.8l29.7 29.7c-6.8-34.8 3.5-70.3 28.5-95.3 20.3-20.3 47.2-31.2 75-31.2h1.2L301 105.3l15.1 90.6 90.6 15.1 57.3-57.3c.3 28.3-10.6 55.5-31.2 76.1-9.3 9.3-20.2 16.4-31.8 21.6 1.8 1.6 3.9 2.9 5.6 4.6l30.7 30.7c10.5-6.3 20.5-13.9 29.4-22.9 38.1-38.1 53.7-94.3 40.7-146.6C504.4 105 495 95.4 483 92c-12.2-3.4-25.2.1-34 9l-58.7 58.6-32.4-5.4-5.4-32.4 58.6-58.6c8.9-8.9 12.3-21.9 8.9-34-3.3-12.1-13-21.5-25.2-24.5-53.2-13.2-107.9 2-146.6 40.6C238 55.5 229.7 67 222.9 79.2l1.1.8v16.1zM106 454c-12.8 12.8-35.3 12.8-48.1 0-6.4-6.4-10-15-10-24 0-9.1 3.5-17.6 10-24l134.4-134.4-33.9-33.9L24 372C8.5 387.5 0 408.1 0 430s8.5 42.5 24 58 36.1 24 58 24 42.5-8.5 58-24l100.9-100.9c-9.7-15.8-15.2-33.8-15.7-52.1L106 454zm395.1-58.3L384 278.6c-23.1-23.1-57.6-27.6-85.4-13.9L192 158.1V96L64 0 0 64l96 128h62.1l106.6 106.6c-13.6 27.8-9.2 62.3 13.9 85.4l117.1 117.1c14.6 14.6 38.2 14.6 52.7 0l52.7-52.7c14.5-14.6 14.5-38.2 0-52.7z"></path></svg>'},n().trust("<style>.page-item:first-child .page-link {\n\tborder-bottom-left-radius: initial;\n\tborder-top-right-radius: .25rem\n}\n\n.page-item:last-child .page-link {\n\tborder-top-right-radius: initial;\n\tborder-bottom-left-radius: .25rem\n}\n\n.page-item:not(:first-child) .page-link {\n\tmargin-top: -1px;\n\tmargin-left: initial;\n}\n\n"),n()(l.ZP.section,{title:"发布公告"},n()(l.ZP.form,n()(l.ZP.formInput,{value:s.newAnnouncementTitle,style:{width:"90%"},oninput:e=>{s.newAnnouncementTitle=e.target.value}},"标题"),n()("div.userProfile-form-item",n()("label.userProfile-form-label",["内容",n()(l.ZP.doClassReplace("textarea.userProfile-form-input.form-input.ember-text-field.ember-view"),{rows:"10",cols:"90%",style:{width:"90%"},value:s.newAnnouncementContent,oninput:e=>{s.newAnnouncementContent=e.target.value}})]))),n()(l.ZP.button,{disabled:s.newAnnouncementPublishing,onclick:e=>{e.preventDefault(),s.newAnnouncementPublishing=!0,async function(){if(!(await r.Z.PublishAnnouncement(s.newAnnouncementTitle,s.newAnnouncementContent)).success)return l.ZP.showAlert("Error","Failed to publish announcement.");s.newAnnouncementTitle="",s.newAnnouncementContent="",s.newAnnouncementPublishing=!1,n().redraw()}()}},"发布")),n()(l.ZP.section,{title:"用户列表"},n()("div",{style:{display:"flex"}},n()("div.row.pre-scrollable",{style:{height:"250px","flex-grow":1}},n()("table.table",n()("thead",n()("tr",n()("th",{scope:"col"},"UN"),n()("th",{scope:"col"},"PC"),n()("th",{scope:"col"},"PSW(SHA256(1..8))"),n()("th",{scope:"col"},"Actions"))),n()("tbody",i))),n()("nav",{style:{"margin-left":"1.5rem","margin-top":".5rem"}},n()("ul.pagination",{style:{"flex-direction":"column",width:"min-content"}},a))),n()("h5","Query"),n()("div.userlist-query",n()("label",{style:{"margin-top":"auto","margin-bottom":"auto","margin-right":".5rem"}},"Flags"),n()("div",{style:{display:"flex","margin-top":"auto","margin-bottom":"auto","margin-right":".5rem"}},n()("div.form-check",{style:{"margin-right":".2rem"}},n()("input.form-check-input",{type:"checkbox",id:"adminFilterCheck",value:s.whitelist_query_additional[0]?"on":"off",oninput:e=>{"off"==e.target.value?s.whitelist_query_additional[0]=!0:s.whitelist_query_additional[0]=!1,s.oninit()}}),n()("label.form-check-label",{for:"adminFilterCheck"},"Admin")),n()("div.form-check",{style:{"margin-right":".2rem"}},n()("input.form-check-input",{type:"checkbox",id:"PValueFilterCheck",value:s.whitelist_query_additional[1]?"on":"off",oninput:e=>{"off"==e.target.value?s.whitelist_query_additional[1]=!0:s.whitelist_query_additional[1]=!1,s.oninit()}}),n()("label.form-check-label",{for:"PValueFilterCheck"},"P")),n()("div.form-check",{style:{"margin-right":".2rem"}},n()("input.form-check-input",{type:"checkbox",id:"BannedFilterCheck",value:s.whitelist_query_additional[2]?"on":"off",oninput:e=>{"off"==e.target.value?s.whitelist_query_additional[2]=!0:s.whitelist_query_additional[2]=!1,s.oninit()}}),n()("label.form-check-label",{for:"BannedFilterCheck"},"Banned")),n()("div.form-check",{style:{"margin-right":".2rem"}},n()("input.form-check-input",{type:"checkbox",id:"HasPCFilterCheck",value:s.whitelist_query_additional[3]?"on":"off",oninput:e=>{"off"==e.target.value?s.whitelist_query_additional[3]=!0:s.whitelist_query_additional[3]=!1,s.oninit()}}),n()("label.form-check-label",{for:"HasPCFilterCheck"},"PC!=0"))),n()("label",{style:{"margin-top":"auto","margin-bottom":"auto","margin-right":".5rem"}},"Username"),n()("input.form-control",{value:s.whitelist_query,oninput:e=>{s.whitelist_query=e.target.value,s.oninit()}}))),p,d,n()(l.ZP.section,{title:"购买记录"},n()("p","なんと！ローを二回押すと、詳細を見ることができるようになった！"),n()("div",{style:{display:"flex"}},n()("div.row.pre-scrollable",{style:{height:"250px"}},n()("table.table",n()("thead",n()("tr",n()("th",{scope:"col"},"Date"),n()("th",{scope:"col"},"Username"),n()("th",{scope:"col"},"Helper"),n()("th",{scope:"col"},"Price"),n()("th",{scope:"col"},"Helper's Price"),n()("th",{scope:"col"},"Description"))),n()("tbody",o))),n()("nav",{style:{"margin-left":"1rem"}},n()("ul",{class:"pagination",style:{"margin-top":"auto","margin-bottom":"auto",width:"min-content","flex-direction":"column"}},u))),n()("h5","Query"),n()("div.plog-query",n()("label",{style:{"margin-right":".5rem","margin-top":"auto","margin-bottom":"auto"}},"Username"),n()("input.form-control",{value:s.payments_query.username,oninput:e=>{s.payments_query.username=e.target.value,s.oninit()},style:{width:"10rem","margin-right":"1rem"}}),n()("label",{style:{"margin-right":".5rem","margin-top":"auto","margin-bottom":"auto"}},"Helper"),n()("input.form-control",{value:s.payments_query.hname,oninput:e=>{s.payments_query.hname=e.target.value,s.oninit()},style:{width:"10rem","margin-right":"1rem"}}),n()("label",{style:{"margin-right":".5rem","margin-top":"auto","margin-bottom":"auto"}},"Description"),n()("input.form-control",{value:s.payments_query.desc,oninput:e=>{s.payments_query.desc=e.target.value,s.oninit()},style:{width:"10rem","margin-right":"1rem"}}))),n()(l.ZP.section,{title:"添加用户"},n()(l.ZP.form,n()(l.ZP.formInput,{value:s.addUser_Username,style:{width:"90%"},oninput:e=>{s.addUser_Username=e.target.value}},"用户名"),n()(l.ZP.formInput,{value:s.addUser_Password,style:{width:"90%"},isPassword:!0,oninput:e=>{s.addUser_Password=e.target.value}},"密码")),n()(l.ZP.button,{disabled:s.addUser_InProgress,onclick:()=>{s.addUser_InProgress=!0,(async()=>{let e=await r.Z.AddUser(s.addUser_Username,s.addUser_Password);if(!e.success)return s.addUser_InProgress=!1,l.ZP.showAlert("Error",e.msg),n().redraw();s.addUser_InProgress=!1,s.addUser_Username="",s.addUser_Password="",s.oninit()})()}},"添加")),n()(l.ZP.section,{title:"添加余额"},n()(l.ZP.form,n()(l.ZP.formInput,{value:s.az_TargetUsername,style:{width:"90%"},oninput:e=>{s.az_TargetUsername=e.target.value}},"用户名"),n()(l.ZP.formInput,{value:s.az_Value,style:{width:"90%"},oninput:e=>{s.az_Value=e.target.value}},"值")),n()(l.ZP.button,{disabled:s.az_InProgress,onclick:()=>{s.az_InProgress=!0,(async()=>{if(!(await r.Z.AddBalance(s.az_TargetUsername,s.az_Value)).success)return s.az_InProgress=!1,l.ZP.showAlert("Error","Failed"),void n().redraw();s.az_InProgress=!1,s.az_TargetUsername="",s.az_Value="",n().redraw()})()}},"添加")))}};const o=s}}]);