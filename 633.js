"use strict";(self.webpackChunkwebpages=self.webpackChunkwebpages||[]).push([[633],{1633:(t,e,n)=>{n.r(e),n.d(e,{default:()=>r});var c=n(865),a=n.n(c),i=n(578),o=n(2641);let l={detail_identifier:0,can_reply:!1,contact_title:"",contact_list:[],oninit:async()=>{l.new_contact_title="",l.contact_content="",l.contact_reply_anonymous=!1,l.contact_closing=!1,l.contact_add_in_progress=!1,l.can_reply=!1,l.detail_identifier=0,l.contact_list=[];let t=await o.Z.GetUserContacts(0);l.contact_list=t.contacts,a().redraw()},view:t=>{let e=[];if(l.detail_identifier){let t=!1;localStorage.getItem("admin")&&(t=!0),e.push(a()(i.ZP.section,{title:""},a()(i.ZP.button,{style:"margin-right: 2rem;",onclick:()=>{l.oninit()}},"返回"),a()(i.ZP.button,{onclick:async()=>{if(!await i.ZP.question("确认","确认要删除本联络吗？",!0))return;let t=await o.Z.DeleteUserContact(l.detail_identifier);if(!t.success)return i.ZP.showAlert("失败",t.message);l.oninit()}},"删除本联络"))),l.can_reply&&e.push(a()(i.ZP.section,{title:"回复/追加"},a()(i.ZP.form,t?a()("div.form-check",{style:{"margin-right":".2rem"}},a()("input.form-check-input",{type:"checkbox",id:"contact_anonymous_check",value:l.contact_reply_anonymous?"on":"off",oninput:t=>{"off"==t.target.value?l.contact_reply_anonymous=!0:l.contact_reply_anonymous=!1}}),a()("label.form-check-label",{for:"contact_anonymous_check",style:"margin-right:1rem;"},"匿名")):null,t?a()("div.form-check",{style:{"margin-right":".2rem"}},a()("input.form-check-input",{type:"checkbox",id:"contact_closing_check",value:l.contact_closing?"on":"off",oninput:t=>{"off"==t.target.value?l.contact_closing=!0:l.contact_closing=!1}}),a()("label.form-check-label",{for:"contact_closing_check"},"关闭此联络")):null,a()("div.userProfile-form-item",a()("label.userProfile-form-label",["内容",a()(i.ZP.doClassReplace("textarea.userProfile-form-input.form-input.ember-text-field.ember-view"),{rows:"10",cols:"90%",style:{width:"90%"},value:l.contact_content,oninput:t=>{l.contact_content=t.target.value}})])),a()(i.ZP.button,{disabled:l.contact_add_in_progress,onclick:t=>{t.preventDefault(),l.contact_add_in_progress=!0,(async()=>{let t=await o.Z.UpdateUserContact(l.detail_identifier,l.contact_content,l.contact_reply_anonymous,l.contact_closing);if(!t.success)return l.contact_add_in_progress=!1,i.ZP.showAlert("失败",t.message);l.contact_add_in_progress=!1;let e=await o.Z.GetUserContacts(l.detail_identifier);l.contact_list=e.item.thread,l.contact_title=e.item.title,l.can_reply=e.item.user_can_add_msg,l.contact_content="",a().redraw()})()}},"追加"))));for(let t of l.contact_list){let n=[],c=t.content.split("\n");for(let t of c)n.push(a()("p",t.toString()));e.push(a()(i.ZP.section,{title:""},a()("p",["发送方: ",t.sender]),a()("p",["日期: ",new Date(parseInt(t.time+"000")).toLocaleString()]),a()("hr"),n))}}else{localStorage.getItem("admin")||e.push(a()(i.ZP.section,{title:"创建联络"},a()(i.ZP.form,a()(i.ZP.formInput,{value:l.new_contact_title,style:{width:"90%"},oninput:t=>{l.new_contact_title=t.target.value}},"标题"),a()("div.userProfile-form-item",a()("label.userProfile-form-label",["内容",a()(i.ZP.doClassReplace("textarea.userProfile-form-input.form-input.ember-text-field.ember-view"),{rows:"10",cols:"90%",style:{width:"90%"},value:l.contact_content,oninput:t=>{l.contact_content=t.target.value}})])),a()(i.ZP.button,{disabled:l.contact_add_in_progress,onclick:t=>{t.preventDefault(),l.contact_add_in_progress=!0,(async()=>{let t=await o.Z.CreateUserContact(l.new_contact_title,l.contact_content);if(!t.success)return l.contact_add_in_progress=!1,void i.ZP.showAlert("失败",t.message);l.contact_add_in_progress=!1,l.detail_identifier=t.identifier;let e=await o.Z.GetUserContacts(t.identifier);l.contact_list=e.item.thread,l.contact_title=e.item.title,l.can_reply=e.item.user_can_add_msg,l.contact_content="",a().redraw()})()}},"创建"))));for(let t in l.contact_list){let n=l.contact_list[t];e.push(a()(i.ZP.section,{title:n.title},n.has_update?a()("p",a()("b",{style:"color:red;"},"(新消息)")):null,n.closed?a()("p",a()("b",{style:"color:gray;"},"(已关闭)")):null,a()(i.ZP.button,{onclick:async()=>{l.detail_identifier=n.identifier;let t=await o.Z.GetUserContacts(n.identifier);l.contact_list=t.item.thread,l.contact_title=t.item.title,l.can_reply=t.item.user_can_add_msg,a().redraw()}},"查看")))}}return a()(i.ZP.frame,{pageName:l.detail_identifier?`联络: ${l.contact_title}`:"联络",pageIcon:'<svg class="sectionTitle-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 512 512"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 448c-110.532 0-200-89.431-200-200 0-110.495 89.472-200 200-200 110.491 0 200 89.471 200 200 0 110.53-89.431 200-200 200zm0-338c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></svg>'},e)}};const r=l}}]);